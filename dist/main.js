(()=>{"use strict";const e=e=>{const t=e;let a=[];(()=>{for(let e=0;e<t;e++)a.push("")})();const r=()=>a.every((e=>"hit"===e));return{length:t,hitSpots:a,hit:e=>{a[e]="hit",r()},isSunk:r}},t=()=>{const t=[];let a="horizontal";const r=[],o=[];let l=[];const n=(e,t)=>l.some((a=>e.includes(a[0])&&t.includes(a[1])));return{place:(r,o,c)=>{if("horizontal"==a){const a=e(r),s=[],i=[];return(()=>{for(let e=0;e<a.length;e++)s.push(o+e);i.push(c)})(),n(s,i)||o+r>10?"failed":(t.push({locationsH:s,locationsV:i,newShip:a}),l.push([o-1,c]),l.push([o+r,c]),s.forEach((e=>{l.push([e,i[0]])})),s.forEach((e=>{l.push([e,i[0]-1])})),s.forEach((e=>{l.push([e,i[0]+1])})),"placed")}if("vertical"==a){const a=e(r),s=[],i=[];return(()=>{s.push(o);for(let e=0;e<a.length;e++)i.push(c+e)})(),n(s,i)||c+r>10?"failed":(t.push({locationsH:s,locationsV:i,newShip:a}),l.push([o,c-1]),l.push([o,c+r]),i.forEach((e=>{l.push([s[0],e])})),i.forEach((e=>{l.push([s[0]-1,e])})),i.forEach((e=>{l.push([s[0]+1,e])})),"placed")}},change:function(){return"vertical"!=a?(a="vertical","vertical"):(a="horizontal","horizontal")},receiveAttack:(e,a)=>{let l,n;return l=t.find((t=>t.locationsH.includes(e)&&t.locationsV.includes(a))),null==l?(o.push([e,a]),r.push([e,a]),"miss"):1==l.locationsV.length?(n=l.locationsH.findIndex((t=>t==e)),l.newShip.hit(n),o.push([e,a]),"hit"):(n=l.locationsV.findIndex((e=>e==a)),l.newShip.hit(n),o.push([e,a]),"hit")},allSunk:()=>!(!t.every((e=>e.newShip.isSunk()))||!t[0]),checkCollision:n,shot:r,missed:o,ships:t,arrangement:a,occupied:l}};function a(e){const t=Array.from(document.querySelectorAll(".computer-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,o=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));o.forEach((e=>e.classList.add("occupied"))),e.newShip.isSunk()&&o.forEach((e=>e.classList.add("down")))}))}const r=(e,t)=>{const a=Array.from(document.querySelectorAll(".player-board > .cell"));let o=e.turn(t);const l=a.find((e=>e.attributes[1].value==o[1]&&e.attributes[2].value==o[2]));return"miss"==o[0]?l.classList.add("miss"):"hit"==o[0]&&(l.classList.add("hit"),r(e,t)),o[0]},o={turn:(e,t,a)=>e.gameboard.receiveAttack(t,a),gameboard:t()},l=(()=>{const e=t();return{turn:e=>{if(!e.gameboard.allSunk()){let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());const r=e=>e[0]==t&&e[1]==a;for(;e.gameboard.shot.some(r);)t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());return[e.gameboard.receiveAttack(t,a),t,a]}},gameboard:e,placeVerySmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(1,a,r)&&t++}while(t<4)},placeSmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(2,a,r)?t++:e.change()}while(t<3)},placeMediumShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(3,a,r)&&t++}while(t<2)},placeLargeShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(4,a,r)?t++:e.change()}while(1!=t)}}})();(()=>{const e=document.querySelector(".player-board"),t=document.querySelector(".computer-board");for(let a=0;a<10;a++)for(let r=0;r<10;r++){const o=document.createElement("div"),l=document.createElement("div");o.classList.add("cell"),o.setAttribute("x",r),o.setAttribute("y",a),e.appendChild(o),l.classList.add("cell"),l.setAttribute("x",r),l.setAttribute("y",a),t.appendChild(l)}})(),l.placeVerySmallShips(),l.placeSmallShips(),l.placeMediumShips(),l.placeLargeShips(),a(l),document.querySelector('input[name="length"]').checked=!0,((e,t)=>{let o=document.querySelectorAll('input[name="length"]'),l=1;o.forEach((e=>{e.addEventListener("change",(e=>{l=parseInt(e.target.value)}))}));let n=0,c=0,s=0,i=0;function d(o){const u=parseInt(o.target.getAttribute("x")),p=parseInt(o.target.getAttribute("y"));if(1==l&&n<4){if("placed"!=e.gameboard.place(l,u,p))return;n++,o.target.removeEventListener("click",d)}else if(2==l&&c<3){if("placed"!=e.gameboard.place(l,u,p))return;c++,o.target.removeEventListener("click",d)}else if(3==l&&s<2){if("placed"!=e.gameboard.place(l,u,p))return;s++,o.target.removeEventListener("click",d)}else if(4==l&&i<1){if("placed"!=e.gameboard.place(l,u,p))return;i++,o.target.removeEventListener("click",d)}4==n&&3==c&&2==s&&1==i&&(h.forEach((e=>{e.removeEventListener("click",d)})),((e,t)=>{const o=document.querySelectorAll(".computer-board > .cell");function l(n){const c=parseInt(n.target.getAttribute("x")),s=parseInt(n.target.getAttribute("y")),i=e.turn(t,c,s);"hit"==i?n.target.classList.add("hit"):"miss"==i&&(n.target.classList.add("miss"),r(t,e)),(t.gameboard.allSunk()||e.gameboard.allSunk())&&o.forEach((e=>{e.removeEventListener("click",l)})),a(t),n.target.removeEventListener("click",l)}(t.gameboard.allSunk()||e.gameboard.allSunk())&&o.forEach((e=>{e.removeEventListener("click",l)})),o.forEach((e=>{e.addEventListener("click",l)}))})(e,t)),function(e){const t=Array.from(document.querySelectorAll(".player-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,o=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));o.forEach((e=>e.classList.add("occupied"))),e.newShip.isSunk()&&o.forEach((e=>e.classList.add("down")))}))}(e)}const h=document.querySelectorAll(".player-board > .cell");h.forEach((e=>{e.addEventListener("click",d)}))})(o,l),(e=>{const t=document.querySelector("#change-arrangement"),a=document.querySelector("#arrangement");a.textContent=e.gameboard.arrangament,t.addEventListener("click",(()=>{a.textContent=e.gameboard.change()}))})(o)})();