(()=>{"use strict";const e=e=>{const t=e;let a=[];(()=>{for(let e=0;e<t;e++)a.push("")})();const r=()=>a.every((e=>"hit"===e));return{length:t,hitSpots:a,hit:e=>{a[e]="hit",r()},isSunk:r}},t=()=>{const t=[];let a="horizontal";const r=[],l=[];let o=[];const n=(e,t)=>o.some((a=>e.includes(a[0])&&t.includes(a[1])));return{place:(r,l,s)=>{if("horizontal"==a){const a=e(r),c=[],i=[];return(()=>{for(let e=0;e<a.length;e++)c.push(l+e);i.push(s)})(),n(c,i)||l+r>10?"failed":(t.push({locationsH:c,locationsV:i,newShip:a}),o.push([l-1,s]),o.push([l+r,s]),c.forEach((e=>{o.push([e,i[0]])})),c.forEach((e=>{o.push([e,i[0]-1])})),c.forEach((e=>{o.push([e,i[0]+1])})),"placed")}if("vertical"==a){const a=e(r),c=[],i=[];if((()=>{c.push(l);for(let e=0;e<a.length;e++)i.push(s+e)})(),n(c,i))return"failed";if(s+r>10)return"failed";t.push({locationsH:c,locationsV:i,newShip:a}),o.push([l,s-1]),o.push([l,s+r]),i.forEach((e=>{o.push([c[0],e])})),i.forEach((e=>{o.push([c[0]-1,e])})),i.forEach((e=>{o.push([c[0]+1,e])}))}},change:function(){a="vertical"!=a?"vertical":"horizontal"},receiveAttack:(e,a)=>{let o,n;return o=t.find((t=>t.locationsH.includes(e)&&t.locationsV.includes(a))),null==o?(l.push([e,a]),r.push([e,a]),"miss"):1==o.locationsV.length?(n=o.locationsH.findIndex((t=>t==e)),o.newShip.hit(n),l.push([e,a]),"hit"):(n=o.locationsV.findIndex((e=>e==a)),o.newShip.hit(n),l.push([e,a]),"hit")},allSunk:()=>!!t.every((e=>e.newShip.isSunk())),checkCollision:n,shot:r,missed:l,ships:t,arrangement:a,occupied:o}},a=(e,t)=>{const r=Array.from(document.querySelectorAll(".player-board > .cell"));let l=e.turn(t);const o=r.find((e=>e.attributes[1].value==l[1]&&e.attributes[2].value==l[2]));return"miss"==l[0]?o.classList.add("miss"):"hit"==l[0]&&(o.classList.add("hit"),a(e,t)),l[0]},r=(e,t)=>{let r=1,l=1;function o(n){const s=parseInt(n.target.getAttribute("x")),c=parseInt(n.target.getAttribute("y"));e.gameboard.place(l,s,c),function(e){const t=Array.from(document.querySelectorAll(".player-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,l=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));l.forEach((e=>e.classList.add("occupied"))),e.newShip.isSunk()&&l.forEach((e=>e.classList.add("down")))}))}(e),r++,5==r?l=2:8==r?l=3:10==r?l=4:11==r&&(document.querySelectorAll(".player-board > .cell").forEach((e=>{e.removeEventListener("click",o)})),((e,t)=>{const r=document.querySelectorAll(".computer-board > .cell");function l(o){const n=parseInt(o.target.getAttribute("x")),s=parseInt(o.target.getAttribute("y")),c=e.turn(t,n,s);"hit"==c?o.target.classList.add("hit"):"miss"==c&&(o.target.classList.add("miss"),a(t,e)),(t.gameboard.allSunk()||e.gameboard.allSunk())&&r.forEach((e=>{e.removeEventListener("click",l)})),function(e){const t=Array.from(document.querySelectorAll(".computer-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,l=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));e.newShip.isSunk()&&l.forEach((e=>e.classList.add("down")))}))}(t),o.target.removeEventListener("click",l)}(t.gameboard.allSunk()||e.gameboard.allSunk())&&r.forEach((e=>{e.removeEventListener("click",l)})),r.forEach((e=>{e.addEventListener("click",l)}))})(e,t)),n.target.removeEventListener("click",o)}document.querySelectorAll(".player-board > .cell").forEach((e=>{e.addEventListener("click",o)}))},l={turn:(e,t,a)=>e.gameboard.receiveAttack(t,a),gameboard:t()};(()=>{(()=>{const e=document.querySelector(".player-board"),t=document.querySelector(".computer-board");for(let a=0;a<10;a++)for(let r=0;r<10;r++){const l=document.createElement("div"),o=document.createElement("div");l.classList.add("cell"),l.setAttribute("x",r),l.setAttribute("y",a),e.appendChild(l),o.classList.add("cell"),o.setAttribute("x",r),o.setAttribute("y",a),t.appendChild(o)}})();const e=(()=>{const e=t();return{turn:e=>{let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());const r=e=>e[0]==t&&e[1]==a;for(;e.gameboard.shot.some(r);)t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());return[e.gameboard.receiveAttack(t,a),t,a]},gameboard:e,placeVerySmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(1,a,r)&&t++}while(t<4)},placeSmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(2,a,r)?t++:e.change()}while(t<3)},placeMediumShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(3,a,r)&&t++}while(t<2)},placeLargeShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(4,a,r)?t++:e.change()}while(1!=t)}}})();e.placeVerySmallShips(),e.placeSmallShips(),e.placeMediumShips(),e.placeLargeShips(),r(l,e),l.gameboard.allSunk()&&!l.gameboard.ships[0].newShip.isSunk()?alert("you win!"):!l.gameboard.allSunk()&&e.gameboard.allSunk()&&alert("you wins!")})()})();