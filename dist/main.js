(()=>{"use strict";const e=e=>{const t=e;let a=[];(()=>{for(let e=0;e<t;e++)a.push("")})();const l=()=>a.every((e=>"hit"===e));return{length:t,hitSpots:a,hit:e=>{a[e]="hit",l()},isSunk:l}},t=()=>{const t=[];let a="horizontal";const l=[],r=[];let o=[];const n=(e,t)=>o.some((a=>e.includes(a[0])&&t.includes(a[1])));return{place:(l,r,s)=>{if("horizontal"==a){const a=e(l),c=[],i=[];return(()=>{for(let e=0;e<a.length;e++)c.push(r+e);i.push(s)})(),n(c,i)||r+l>10?"failed":(t.push({locationsH:c,locationsV:i,newShip:a}),o.push([r-1,s]),o.push([r+l,s]),c.forEach((e=>{o.push([e,i[0]])})),c.forEach((e=>{o.push([e,i[0]-1])})),c.forEach((e=>{o.push([e,i[0]+1])})),"placed")}if("vertical"==a){const a=e(l),c=[],i=[];if((()=>{c.push(r);for(let e=0;e<a.length;e++)i.push(s+e)})(),n(c,i))return"failed";if(s+l>10)return"failed";t.push({locationsH:c,locationsV:i,newShip:a}),o.push([r,s-1]),o.push([r,s+l]),i.forEach((e=>{o.push([c[0],e])})),i.forEach((e=>{o.push([c[0]-1,e])})),i.forEach((e=>{o.push([c[0]+1,e])}))}},change:function(){a="vertical"!=a?"vertical":"horizontal"},receiveAttack:(e,a)=>{let o,n;return o=t.find((t=>t.locationsH.includes(e)&&t.locationsV.includes(a))),null==o?(r.push([e,a]),l.push([e,a]),"miss"):1==o.locationsV.length?(n=o.locationsH.findIndex((t=>t==e)),o.newShip.hit(n),r.push([e,a]),"hit"):(n=o.locationsV.findIndex((e=>e==a)),o.newShip.hit(n),r.push([e,a]),"hit")},allSunk:()=>!!t.every((e=>e.newShip.isSunk())),checkCollision:n,shot:l,missed:r,ships:t,arrangement:a,occupied:o}},a=(e,t)=>{const l=Array.from(document.querySelectorAll(".player-board > .cell"));let r=e.turn(t);const o=l.find((e=>e.attributes[1].value==r[1]&&e.attributes[2].value==r[2]));return"miss"==r[0]?o.classList.add("miss"):"hit"==r[0]&&(o.classList.add("hit"),a(e,t)),r[0]},l=(e,t)=>{let l=document.querySelectorAll('input[name="length"]'),r=1;l.forEach((e=>{e.addEventListener("change",(e=>{r=parseInt(e.target.value)}))}));let o=0,n=0,s=0,c=0;function i(l){console.log(r);const d=parseInt(l.target.getAttribute("x")),u=parseInt(l.target.getAttribute("y"));if(1==r&&o<4){if("placed"!=e.gameboard.place(r,d,u))return;o++}else if(2==r&&n<3){if("placed"!=e.gameboard.place(r,d,u))return;n++}else if(3==r&&s<2){if("placed"!=e.gameboard.place(r,d,u))return;s++}else if(4==r&&c<1){if("placed"!=e.gameboard.place(r,d,u))return;c++}4==o&&3==n&&2==s&&1==c&&(h.forEach((e=>{e.removeEventListener("click",i)})),((e,t)=>{const l=document.querySelectorAll(".computer-board > .cell");function r(o){const n=parseInt(o.target.getAttribute("x")),s=parseInt(o.target.getAttribute("y")),c=e.turn(t,n,s);"hit"==c?o.target.classList.add("hit"):"miss"==c&&(o.target.classList.add("miss"),a(t,e)),(t.gameboard.allSunk()||e.gameboard.allSunk())&&l.forEach((e=>{e.removeEventListener("click",r)})),function(e){const t=Array.from(document.querySelectorAll(".computer-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,l=e.locationsV,r=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&l.includes(parseInt(e.attributes[2].value))));e.newShip.isSunk()&&r.forEach((e=>e.classList.add("down")))}))}(t),o.target.removeEventListener("click",r)}(t.gameboard.allSunk()||e.gameboard.allSunk())&&l.forEach((e=>{e.removeEventListener("click",r)})),l.forEach((e=>{e.addEventListener("click",r)}))})(e,t)),function(e){const t=Array.from(document.querySelectorAll(".player-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,l=e.locationsV,r=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&l.includes(parseInt(e.attributes[2].value))));r.forEach((e=>e.classList.add("occupied"))),e.newShip.isSunk()&&r.forEach((e=>e.classList.add("down")))}))}(e),console.log("vsmall"+o+" small"+n+" med "+s+" l "+c),l.target.removeEventListener("click",i)}const h=document.querySelectorAll(".player-board > .cell");h.forEach((e=>{e.addEventListener("click",i)}))},r={turn:(e,t,a)=>e.gameboard.receiveAttack(t,a),gameboard:t()};(()=>{(()=>{const e=document.querySelector(".player-board"),t=document.querySelector(".computer-board");for(let a=0;a<10;a++)for(let l=0;l<10;l++){const r=document.createElement("div"),o=document.createElement("div");r.classList.add("cell"),r.setAttribute("x",l),r.setAttribute("y",a),e.appendChild(r),o.classList.add("cell"),o.setAttribute("x",l),o.setAttribute("y",a),t.appendChild(o)}})();const e=(()=>{const e=t();return{turn:e=>{let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());const l=e=>e[0]==t&&e[1]==a;for(;e.gameboard.shot.some(l);)t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());return[e.gameboard.receiveAttack(t,a),t,a]},gameboard:e,placeVerySmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),l=Math.floor(10*Math.random());"failed"!=e.place(1,a,l)&&t++}while(t<4)},placeSmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),l=Math.floor(10*Math.random());"failed"!=e.place(2,a,l)?t++:e.change()}while(t<3)},placeMediumShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),l=Math.floor(10*Math.random());"failed"!=e.place(3,a,l)&&t++}while(t<2)},placeLargeShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),l=Math.floor(10*Math.random());"failed"!=e.place(4,a,l)?t++:e.change()}while(1!=t)}}})();e.placeVerySmallShips(),e.placeSmallShips(),e.placeMediumShips(),e.placeLargeShips(),document.querySelector('input[name="length"]').checked=!0,l(r,e),r.gameboard.allSunk()&&!r.gameboard.ships[0].newShip.isSunk()?alert("you win!"):e.gameboard.allSunk()&&!e.gameboard.ships[0].newShip.isSunk()&&alert("you wins!")})()})();