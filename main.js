(()=>{"use strict";const e=e=>{const t=e;let r=[];(()=>{for(let e=0;e<t;e++)r.push("")})();const a=()=>r.every((e=>"hit"===e));return{length:t,hitSpots:r,hit:e=>{r[e]="hit",a()},isSunk:a}},t=()=>{const t=[];let r="horizontal";const a=[],o=[];let n=[];const l=(e,t)=>n.some((r=>e.includes(r[0])&&t.includes(r[1])));return{place:(a,o,i)=>{if("horizontal"==r){const r=e(a),s=[],c=[];return(()=>{for(let e=0;e<r.length;e++)s.push(o+e);c.push(i)})(),l(s,c)||o+a>10?"failed":(t.push({locationsH:s,locationsV:c,newShip:r}),n.push([o-1,i]),n.push([o+a,i]),s.forEach((e=>{n.push([e,c[0]])})),s.forEach((e=>{n.push([e,c[0]-1])})),s.forEach((e=>{n.push([e,c[0]+1])})),"placed")}if("vertical"==r){const r=e(a),s=[],c=[];return(()=>{s.push(o);for(let e=0;e<r.length;e++)c.push(i+e)})(),l(s,c)||i+a>10?"failed":(t.push({locationsH:s,locationsV:c,newShip:r}),n.push([o,i-1]),n.push([o,i+a]),c.forEach((e=>{n.push([s[0],e])})),c.forEach((e=>{n.push([s[0]-1,e])})),c.forEach((e=>{n.push([s[0]+1,e])})),"placed")}},change:function(){return"vertical"!=r?(r="vertical","vertical"):(r="horizontal","horizontal")},receiveAttack:(e,r)=>{let n,l;return n=t.find((t=>t.locationsH.includes(e)&&t.locationsV.includes(r))),null==n?(o.push([e,r]),a.push([e,r]),"miss"):1==n.locationsV.length?(l=n.locationsH.findIndex((t=>t==e)),n.newShip.hit(l),o.push([e,r]),"hit"):(l=n.locationsV.findIndex((e=>e==r)),n.newShip.hit(l),o.push([e,r]),"hit")},allSunk:()=>!(!t.every((e=>e.newShip.isSunk()))||!t[0]),checkCollision:l,shot:a,missed:o,ships:t,arrangement:r,occupied:n}},r=()=>{const e=document.querySelector(".display");return{clear:()=>{e.innerHTML=""},updatePlacing:(t,r,a,o)=>{e.innerHTML=`<p>1 cell ships placed: ${t}<p><br><p>2 cells ships placed: ${r}<p><br><p>3 cells ships placed: ${a}<p><br><p>4 cell ships placed: ${o}<p><br>`},start:()=>{e.innerHTML="<p>THIS IS BATTLESHIP.</p><p>LEFT BOARD BELONGS TO YOU.</p>\n                             <p>YOU CAN PLACE SHIPS(PUPRLE)</p>\n                             <p>BY DRAGING THEM ON YOUR BOARD.</p>\n                             <p>WHEN THE LAST SHIP WILL BE PLACED \n                             <p>THE GAME WILL START AUTOMATICALLY.</p>\n                             <p>GOOD LUCK!</p>"},playerWon:()=>{e.innerHTML="<p>PLAYER WON!</p>"},computerWon:()=>{e.innerHTML="<p>COMPUTER WON!</p>"},playerHit:()=>{e.innerHTML="<p>YOU HIT THE ENEMY.</p><p>YOU CAN MAKE ANOTHER TURN!</p>"},computersTurn:()=>{e.innerHTML="<p>YOU MISEED THE ENEMY.</p><p>IT IS COMPUTER'S TURN</p>"},computerMiss:()=>{e.innerHTML="<p>COMPUTER MISSED.</p><p>IT IS NOW YOUR TURN</p>"},noMoreShips:()=>{e.innerHTML="<p>YOU CAN'T PLACE MORE OF THOSE SHIPS</p>"},computerHit:()=>{e.innerHTML="<p>COMPUTER HIT YOU.</p><p>IT WILL MAKE ANOTHER TURN</p>"}}},a=(e,t)=>{const o=Array.from(document.querySelectorAll(".player-board > .cell")),n=r();let l=e.turn(t);const i=o.find((e=>e.attributes[1].value==l[1]&&e.attributes[2].value==l[2]));return"miss"==l[0]?(i.classList.add("miss"),n.computerMiss()):"hit"==l[0]&&(i.classList.add("hit"),n.computerHit(),setTimeout((()=>a(e,t)),500)),l[0]};const o={turn:(e,t,r)=>e.gameboard.receiveAttack(t,r),gameboard:t()},n=(()=>{const e=t();return{turn:e=>{if(!e.gameboard.allSunk()){let t=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());const a=e=>e[0]==t&&e[1]==r;for(;e.gameboard.shot.some(a);)t=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());return[e.gameboard.receiveAttack(t,r),t,r]}},gameboard:e,placeVerySmallShips:()=>{let t=0;do{let r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());"failed"!=e.place(1,r,a)&&t++}while(t<4)},placeSmallShips:()=>{let t=0;do{let r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());"failed"!=e.place(2,r,a)?t++:e.change()}while(t<3)},placeMediumShips:()=>{let t=0;do{let r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());"failed"!=e.place(3,r,a)&&t++}while(t<2)},placeLargeShips:()=>{let t=0;do{let r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());"failed"!=e.place(4,r,a)?t++:e.change()}while(1!=t)}}})();(()=>{const e=document.querySelector(".player-board"),t=document.querySelector(".computer-board");for(let r=0;r<10;r++)for(let a=0;a<10;a++){const o=document.createElement("div"),n=document.createElement("div");o.classList.add("cell"),o.setAttribute("x",a),o.setAttribute("y",r),e.appendChild(o),n.classList.add("cell"),n.setAttribute("x",a),n.setAttribute("y",r),t.appendChild(n)}})(),(e=>{const t=document.querySelector("#change-arrangement"),r=document.querySelector("#arrangement"),a=document.querySelector(".ships"),o=document.querySelector(".vs"),n=document.querySelector(".s"),l=document.querySelector(".m"),i=document.querySelector(".l");r.textContent=e.gameboard.arrangament,t.addEventListener("click",(()=>{const t=e.gameboard.change();r.textContent=t,"horizontal"==t?(a.style.flexDirection="column",o.style.flexDirection="row",n.style.flexDirection="row",l.style.flexDirection="row",i.style.flexDirection="row"):"vertical"==t&&(a.style.flexDirection="row",o.style.flexDirection="column",n.style.flexDirection="column",l.style.flexDirection="column",i.style.flexDirection="column")}))})(o),function(e,t){const o=Array.from(document.querySelectorAll(".player-board > .cell")),n=document.querySelector("#arrangement");n.textContent="horizontal";const l=r();l.start();const i=document.querySelector(".vs"),s=document.querySelector(".s"),c=document.querySelector(".m"),d=document.querySelector(".l");let u=0,p=0,h=0,m=0,f=0;function S(e){e.dataTransfer.setData("text/plain",this.getAttribute("length")),u=parseInt(this.getAttribute("length"))}function g(t){const r=Array.from(this.getAttribute("x")).map((e=>parseInt(e))),a=Array.from(this.getAttribute("y")).map((e=>parseInt(e)));if(u>1)if("horizontal"==n.textContent)for(let e=1;e<u;e++)r.push(r[0]+e);else if("vertical"==n.textContent)for(let e=1;e<u;e++)a.push(a[0]+e);const o=e.gameboard.checkCollision(r,a);r.length>a.length?0==o?r.forEach((e=>{document.querySelector(`.player-board > div[x="${e}"][y="${a[0]}"]`).classList.add("valid")})):r.forEach((e=>{document.querySelector(`.player-board > div[x="${e}"][y="${a[0]}"]`).classList.add("invalid")})):r.length<a.length?0==o?a.forEach((e=>{document.querySelector(`.player-board > div[x="${r[0]}"][y="${e}"]`).classList.add("valid")})):a.forEach((e=>{document.querySelector(`.player-board > div[x="${r[0]}"][y="${e}"]`).classList.add("invalid")})):0==o?this.classList.add("valid"):this.classList.add("invalid"),t.preventDefault()}function y(e){const t=Array.from(this.getAttribute("x")).map((e=>parseInt(e))),r=Array.from(this.getAttribute("y")).map((e=>parseInt(e)));if(u>1)if("horizontal"==n.textContent)for(let e=1;e<u;e++)t.push(t[0]+e);else if("vertical"==n.textContent)for(let e=1;e<u;e++)r.push(r[0]+e);t.length>r.length?t.forEach((e=>{document.querySelector(`.player-board > div[x="${e}"][y="${r[0]}"]`).classList.remove("valid","invalid")})):t.length<r.length?r.forEach((e=>{document.querySelector(`.player-board > div[x="${t[0]}"][y="${e}"]`).classList.remove("valid","invalid")})):this.classList.remove("valid","invalid")}function E(n){const i=parseInt(this.getAttribute("x")),s=parseInt(this.getAttribute("y")),c=e.gameboard.checkCollision([i],[s]),d=parseInt(n.dataTransfer.getData("text/plain"));0==c&&1==d&&p<4?(e.gameboard.place(1,i,s),p++,l.updatePlacing(p,h,m,f)):1==d&&4==p?(l.noMoreShips(),setTimeout((()=>l.updatePlacing(p,h,m,f)),2e3)):0==c&&2==d&&h<3?(e.gameboard.place(2,i,s),h++,l.updatePlacing(p,h,m,f)):2==d&&3==h?(l.noMoreShips(),setTimeout((()=>l.updatePlacing(p,h,m,f)),2e3)):0==c&&3==d&&m<2?(e.gameboard.place(3,i,s),m++,l.updatePlacing(p,h,m,f)):2==d&&2==m?(l.noMoreShips(),setTimeout((()=>l.updatePlacing(p,h,m,f)),2e3)):0==c&&4==d&&f<1?(e.gameboard.place(4,i,s),f++,l.updatePlacing(p,h,m,f)):2==d&&2==m&&(l.noMoreShips(),setTimeout((()=>l.updatePlacing(p,h,m,f)),2e3)),o.forEach((e=>{e.classList.remove("valid","invalid")})),function(e){const t=Array.from(document.querySelectorAll(".player-board > .cell"));e.gameboard.ships.forEach((e=>{const r=e.locationsH,a=e.locationsV,o=t.filter((e=>r.includes(parseInt(e.attributes[1].value))&&a.includes(parseInt(e.attributes[2].value))));o.forEach((e=>e.classList.add("occupied"))),e.newShip.isSunk()&&o.forEach((e=>e.classList.add("down")))}))}(e),4==p&&3==h&&2==m&&1==f&&(l.clear(),((e,t)=>{const o=r(),n=document.querySelectorAll(".computer-board > .cell");function l(r){const i=parseInt(r.target.getAttribute("x")),s=parseInt(r.target.getAttribute("y")),c=e.turn(t,i,s);"hit"==c?(r.target.classList.add("hit"),o.playerHit()):"miss"==c?(r.target.classList.add("miss"),o.computersTurn(),setTimeout((()=>a(t,e)),500)):e.gameboard.allSunk()&&e.gameboard.ships[0].newShip.isSunk()?(o.clear(),o.computerWon(),n.forEach((e=>{e.removeEventListener("click",l)}))):t.gameboard.allSunk()&&t.gameboard.ships[0].newShip.isSunk()&&(o.clear(),o.playerWon(),n.forEach((e=>{e.removeEventListener("click",l)}))),function(e){const t=Array.from(document.querySelectorAll(".computer-board > .cell"));e.gameboard.ships.forEach((e=>{const r=e.locationsH,a=e.locationsV,o=t.filter((e=>r.includes(parseInt(e.attributes[1].value))&&a.includes(parseInt(e.attributes[2].value))));e.newShip.isSunk()&&o.forEach((e=>e.classList.add("down")))}))}(t),r.target.removeEventListener("click",l)}(t.gameboard.allSunk()||e.gameboard.allSunk())&&n.forEach((e=>{e.removeEventListener("click",l)})),n.forEach((e=>{e.addEventListener("click",l)}))})(e,t))}i.addEventListener("dragstart",S),s.addEventListener("dragstart",S),c.addEventListener("dragstart",S),d.addEventListener("dragstart",S),o.forEach((e=>{e.addEventListener("dragleave",y)})),o.forEach((e=>{e.addEventListener("dragover",g)})),o.forEach((e=>{e.addEventListener("drop",E)}))}(o,n),n.placeVerySmallShips(),n.placeSmallShips(),n.placeMediumShips(),n.placeLargeShips()})();