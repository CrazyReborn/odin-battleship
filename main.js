(()=>{"use strict";const e=e=>{const t=e;let a=[];(()=>{for(let e=0;e<t;e++)a.push("")})();const r=()=>a.every((e=>"hit"===e));return{length:t,hitSpots:a,hit:e=>{a[e]="hit",r()},isSunk:r}},t=()=>{const t=[];let a="horizontal";const r=[],l=[];let n=[];const o=(e,t)=>n.some((a=>e.includes(a[0])&&t.includes(a[1])));return{place:(r,l,c)=>{if("horizontal"==a){const a=e(r),i=[],s=[];return(()=>{for(let e=0;e<a.length;e++)i.push(l+e);s.push(c)})(),o(i,s)||l+r>10?"failed":(t.push({locationsH:i,locationsV:s,newShip:a}),n.push([l-1,c]),n.push([l+r,c]),i.forEach((e=>{n.push([e,s[0]])})),i.forEach((e=>{n.push([e,s[0]-1])})),i.forEach((e=>{n.push([e,s[0]+1])})),"placed")}if("vertical"==a){const a=e(r),i=[],s=[];return(()=>{i.push(l);for(let e=0;e<a.length;e++)s.push(c+e)})(),o(i,s)||c+r>10?"failed":(t.push({locationsH:i,locationsV:s,newShip:a}),n.push([l,c-1]),n.push([l,c+r]),s.forEach((e=>{n.push([i[0],e])})),s.forEach((e=>{n.push([i[0]-1,e])})),s.forEach((e=>{n.push([i[0]+1,e])})),"placed")}},change:function(){return"vertical"!=a?(a="vertical","vertical"):(a="horizontal","horizontal")},receiveAttack:(e,a)=>{let n,o;return n=t.find((t=>t.locationsH.includes(e)&&t.locationsV.includes(a))),null==n?(l.push([e,a]),r.push([e,a]),"miss"):1==n.locationsV.length?(o=n.locationsH.findIndex((t=>t==e)),n.newShip.hit(o),l.push([e,a]),"hit"):(o=n.locationsV.findIndex((e=>e==a)),n.newShip.hit(o),l.push([e,a]),"hit")},allSunk:()=>!(!t.every((e=>e.newShip.isSunk()))||!t[0]),checkCollision:o,shot:r,missed:l,ships:t,arrangement:a,occupied:n}};function a(e){const t=Array.from(document.querySelectorAll(".computer-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,l=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));e.newShip.isSunk()&&l.forEach((e=>e.classList.add("down")))}))}const r=()=>{const e=document.querySelector(".display");return{clear:()=>{e.innerHTML=""},updatePlacing:(t,a,r,l)=>{e.innerHTML=`<p>1 cell ships placed: ${t}<p><br><p>2 cells ships placed: ${a}<p><br><p>3 cells ships placed: ${r}<p><br><p>4 cell ships placed: ${l}<p><br>`},playerWon:()=>{e.innerHTML="<p>PLAYER WON!</p>"},computerWon:()=>{e.innerHTML="<p>COMPUTER WON!</p>"}}},l=(e,t)=>{const a=Array.from(document.querySelectorAll(".player-board > .cell"));let r=e.turn(t);const n=a.find((e=>e.attributes[1].value==r[1]&&e.attributes[2].value==r[2]));return"miss"==r[0]?n.classList.add("miss"):"hit"==r[0]&&(n.classList.add("hit"),l(e,t)),r[0]},n={turn:(e,t,a)=>e.gameboard.receiveAttack(t,a),gameboard:t()},o=(()=>{const e=t();return{turn:e=>{if(!e.gameboard.allSunk()){let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());const r=e=>e[0]==t&&e[1]==a;for(;e.gameboard.shot.some(r);)t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());return[e.gameboard.receiveAttack(t,a),t,a]}},gameboard:e,placeVerySmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(1,a,r)&&t++}while(t<4)},placeSmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(2,a,r)?t++:e.change()}while(t<3)},placeMediumShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(3,a,r)&&t++}while(t<2)},placeLargeShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(4,a,r)?t++:e.change()}while(1!=t)}}})();(()=>{const e=document.querySelector(".player-board"),t=document.querySelector(".computer-board");for(let a=0;a<10;a++)for(let r=0;r<10;r++){const l=document.createElement("div"),n=document.createElement("div");l.classList.add("cell"),l.setAttribute("x",r),l.setAttribute("y",a),e.appendChild(l),n.classList.add("cell"),n.setAttribute("x",r),n.setAttribute("y",a),t.appendChild(n)}})(),o.placeVerySmallShips(),o.placeSmallShips(),o.placeMediumShips(),o.placeLargeShips(),a(o),document.querySelector('input[name="length"]').checked=!0,((e,t)=>{let n=document.querySelectorAll('input[name="length"]'),o=1;n.forEach((e=>{e.addEventListener("change",(e=>{o=parseInt(e.target.value)}))}));const c=r();let i=0,s=0,d=0,u=0;function h(n){const m=parseInt(n.target.getAttribute("x")),f=parseInt(n.target.getAttribute("y"));if(1==o&&i<4){if("placed"!=e.gameboard.place(o,m,f))return;i++,n.target.removeEventListener("click",h),c.updatePlacing(i,s,d,u)}else if(2==o&&s<3){if("placed"!=e.gameboard.place(o,m,f))return;s++,n.target.removeEventListener("click",h),c.updatePlacing(i,s,d,u)}else if(3==o&&d<2){if("placed"!=e.gameboard.place(o,m,f))return;d++,n.target.removeEventListener("click",h),c.updatePlacing(i,s,d,u)}else if(4==o&&u<1){if("placed"!=e.gameboard.place(o,m,f))return;u++,n.target.removeEventListener("click",h),c.updatePlacing(i,s,d,u)}4==i&&3==s&&2==d&&1==u&&(c.clear(),p.forEach((e=>{e.removeEventListener("click",h)})),((e,t)=>{const n=r(),o=document.querySelectorAll(".computer-board > .cell");function c(r){const i=parseInt(r.target.getAttribute("x")),s=parseInt(r.target.getAttribute("y")),d=e.turn(t,i,s);"hit"==d?r.target.classList.add("hit"):"miss"==d&&(r.target.classList.add("miss"),l(t,e)),e.gameboard.allSunk()&&e.gameboard.ships[0].newShip.isSunk()?(n.clear(),n.computerWon(),o.forEach((e=>{e.removeEventListener("click",c)}))):t.gameboard.allSunk()&&t.gameboard.ships[0].newShip.isSunk()&&(n.clear(),n.playerWon(),o.forEach((e=>{e.removeEventListener("click",c)}))),a(t),r.target.removeEventListener("click",c)}(t.gameboard.allSunk()||e.gameboard.allSunk())&&o.forEach((e=>{e.removeEventListener("click",c)})),o.forEach((e=>{e.addEventListener("click",c)}))})(e,t)),function(e){const t=Array.from(document.querySelectorAll(".player-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,l=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));l.forEach((e=>e.classList.add("occupied"))),e.newShip.isSunk()&&l.forEach((e=>e.classList.add("down")))}))}(e)}const p=document.querySelectorAll(".player-board > .cell");p.forEach((e=>{e.addEventListener("click",h),c.updatePlacing(i,s,d,u)}))})(n,o),(e=>{const t=document.querySelector("#change-arrangement"),a=document.querySelector("#arrangement");a.textContent=e.gameboard.arrangament,t.addEventListener("click",(()=>{a.textContent=e.gameboard.change()}))})(n)})();