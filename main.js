(()=>{"use strict";const e=e=>{const t=e;let a=[];(()=>{for(let e=0;e<t;e++)a.push("")})();const r=()=>a.every((e=>"hit"===e));return{length:t,hitSpots:a,hit:e=>{a[e]="hit",r()},isSunk:r}},t=()=>{const t=[];let a="horizontal";const r=[],o=[];let l=[];const n=(e,t)=>l.some((a=>e.includes(a[0])&&t.includes(a[1])));return{place:(r,o,s)=>{if("horizontal"==a){const a=e(r),c=[],i=[];return(()=>{for(let e=0;e<a.length;e++)c.push(o+e);i.push(s)})(),n(c,i)||o+r>10?"failed":(t.push({locationsH:c,locationsV:i,newShip:a}),l.push([o-1,s]),l.push([o+r,s]),c.forEach((e=>{l.push([e,i[0]])})),c.forEach((e=>{l.push([e,i[0]-1])})),c.forEach((e=>{l.push([e,i[0]+1])})),"placed")}if("vertical"==a){const a=e(r),c=[],i=[];return(()=>{c.push(o);for(let e=0;e<a.length;e++)i.push(s+e)})(),n(c,i)||s+r>10?"failed":(t.push({locationsH:c,locationsV:i,newShip:a}),l.push([o,s-1]),l.push([o,s+r]),i.forEach((e=>{l.push([c[0],e])})),i.forEach((e=>{l.push([c[0]-1,e])})),i.forEach((e=>{l.push([c[0]+1,e])})),"placed")}},change:function(){return"vertical"!=a?(a="vertical","vertical"):(a="horizontal","horizontal")},receiveAttack:(e,a)=>{let l,n;return l=t.find((t=>t.locationsH.includes(e)&&t.locationsV.includes(a))),null==l?(o.push([e,a]),r.push([e,a]),"miss"):1==l.locationsV.length?(n=l.locationsH.findIndex((t=>t==e)),l.newShip.hit(n),o.push([e,a]),"hit"):(n=l.locationsV.findIndex((e=>e==a)),l.newShip.hit(n),o.push([e,a]),"hit")},allSunk:()=>!(!t.every((e=>e.newShip.isSunk()))||!t[0]),checkCollision:n,shot:r,missed:o,ships:t,arrangement:a,occupied:l}},a=(e,t)=>{const r=Array.from(document.querySelectorAll(".player-board > .cell"));let o=e.turn(t);const l=r.find((e=>e.attributes[1].value==o[1]&&e.attributes[2].value==o[2]));return"miss"==o[0]?l.classList.add("miss"):"hit"==o[0]&&(l.classList.add("hit"),a(e,t)),o[0]};const r={turn:(e,t,a)=>e.gameboard.receiveAttack(t,a),gameboard:t()},o=(()=>{const e=t();return{turn:e=>{if(!e.gameboard.allSunk()){let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());const r=e=>e[0]==t&&e[1]==a;for(;e.gameboard.shot.some(r);)t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());return[e.gameboard.receiveAttack(t,a),t,a]}},gameboard:e,placeVerySmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(1,a,r)&&t++}while(t<4)},placeSmallShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(2,a,r)?t++:e.change()}while(t<3)},placeMediumShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(3,a,r)&&t++}while(t<2)},placeLargeShips:()=>{let t=0;do{let a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());"failed"!=e.place(4,a,r)?t++:e.change()}while(1!=t)}}})();(()=>{const e=document.querySelector(".player-board"),t=document.querySelector(".computer-board");for(let a=0;a<10;a++)for(let r=0;r<10;r++){const o=document.createElement("div"),l=document.createElement("div");o.classList.add("cell"),o.setAttribute("x",r),o.setAttribute("y",a),e.appendChild(o),l.classList.add("cell"),l.setAttribute("x",r),l.setAttribute("y",a),t.appendChild(l)}})(),(e=>{const t=document.querySelector("#change-arrangement"),a=document.querySelector("#arrangement"),r=document.querySelector(".ships"),o=document.querySelector(".vs"),l=document.querySelector(".s"),n=document.querySelector(".m"),s=document.querySelector(".l");a.textContent=e.gameboard.arrangament,t.addEventListener("click",(()=>{const t=e.gameboard.change();a.textContent=t,"horizontal"==t?(r.style.flexDirection="column",o.style.flexDirection="row",l.style.flexDirection="row",n.style.flexDirection="row",s.style.flexDirection="row"):"vertical"==t&&(r.style.flexDirection="row",o.style.flexDirection="column",l.style.flexDirection="column",n.style.flexDirection="column",s.style.flexDirection="column")}))})(r),o.placeVerySmallShips(),o.placeSmallShips(),o.placeMediumShips(),o.placeLargeShips(),function(e,t){const r=Array.from(document.querySelectorAll(".player-board > .cell")),o=document.querySelector("#arrangement");o.textContent="horizontal";const l=document.querySelector(".vs"),n=document.querySelector(".s"),s=document.querySelector(".m"),c=document.querySelector(".l");let i=0,d=0,h=0,u=0,p=0;function m(e){e.dataTransfer.setData("text/plain",this.getAttribute("length")),i=parseInt(this.getAttribute("length"))}function f(t){const a=Array.from(this.getAttribute("x")).map((e=>parseInt(e))),r=Array.from(this.getAttribute("y")).map((e=>parseInt(e)));if(i>1)if("horizontal"==o.textContent)for(let e=1;e<i;e++)a.push(a[0]+e);else if("vertical"==o.textContent)for(let e=1;e<i;e++)r.push(r[0]+e);const l=e.gameboard.checkCollision(a,r);a.length>r.length?0==l?a.forEach((e=>{document.querySelector(`.player-board > div[x="${e}"][y="${r[0]}"]`).classList.add("valid")})):a.forEach((e=>{document.querySelector(`.player-board > div[x="${e}"][y="${r[0]}"]`).classList.add("invalid")})):a.length<r.length?0==l?r.forEach((e=>{document.querySelector(`.player-board > div[x="${a[0]}"][y="${e}"]`).classList.add("valid")})):r.forEach((e=>{document.querySelector(`.player-board > div[x="${a[0]}"][y="${e}"]`).classList.add("invalid")})):0==l?this.classList.add("valid"):this.classList.add("invalid"),t.preventDefault()}function g(e){const t=Array.from(this.getAttribute("x")).map((e=>parseInt(e))),a=Array.from(this.getAttribute("y")).map((e=>parseInt(e)));if(i>1)if("horizontal"==o.textContent)for(let e=1;e<i;e++)t.push(t[0]+e);else if("vertical"==o.textContent)for(let e=1;e<i;e++)a.push(a[0]+e);t.length>a.length?t.forEach((e=>{document.querySelector(`.player-board > div[x="${e}"][y="${a[0]}"]`).classList.remove("valid","invalid")})):t.length<a.length?a.forEach((e=>{document.querySelector(`.player-board > div[x="${t[0]}"][y="${e}"]`).classList.remove("valid","invalid")})):this.classList.remove("valid","invalid")}function y(o){const l=parseInt(this.getAttribute("x")),n=parseInt(this.getAttribute("y")),s=e.gameboard.checkCollision([l],[n]),c=parseInt(o.dataTransfer.getData("text/plain"));0==s&&1==c&&d<4?(e.gameboard.place(1,l,n),d++):1==c&&4==d?console.log("cant't place more than 4   very small ships!"):0==s&&2==c&&h<3?(e.gameboard.place(2,l,n),h++):2==c&&3==h?console.log("cant't place more than 3 small ships!"):0==s&&3==c&&u<2?(e.gameboard.place(3,l,n),u++):2==c&&2==u?console.log("cant't place more than 2 medium ships!"):0==s&&4==c&&p<1?(e.gameboard.place(4,l,n),p++):2==c&&2==u&&console.log("cant't place more than 1 large ships!"),r.forEach((e=>{e.classList.remove("valid","invalid")})),function(e){const t=Array.from(document.querySelectorAll(".player-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,o=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));o.forEach((e=>e.classList.add("occupied"))),e.newShip.isSunk()&&o.forEach((e=>e.classList.add("down")))}))}(e),4==d&&3==h&&2==u&&1==p&&((e,t)=>{const r=(()=>{const e=document.querySelector(".display");return{clear:()=>{e.innerHTML=""},updatePlacing:(t,a,r,o)=>{e.innerHTML=`<p>1 cell ships placed: ${t}<p><br><p>2 cells ships placed: ${a}<p><br><p>3 cells ships placed: ${r}<p><br><p>4 cell ships placed: ${o}<p><br>`},playerWon:()=>{e.innerHTML="<p>PLAYER WON!</p>"},computerWon:()=>{e.innerHTML="<p>COMPUTER WON!</p>"}}})(),o=document.querySelectorAll(".computer-board > .cell");function l(n){const s=parseInt(n.target.getAttribute("x")),c=parseInt(n.target.getAttribute("y")),i=e.turn(t,s,c);"hit"==i?n.target.classList.add("hit"):"miss"==i&&(n.target.classList.add("miss"),a(t,e)),e.gameboard.allSunk()&&e.gameboard.ships[0].newShip.isSunk()?(r.clear(),r.computerWon(),o.forEach((e=>{e.removeEventListener("click",l)}))):t.gameboard.allSunk()&&t.gameboard.ships[0].newShip.isSunk()&&(r.clear(),r.playerWon(),o.forEach((e=>{e.removeEventListener("click",l)}))),function(e){const t=Array.from(document.querySelectorAll(".computer-board > .cell"));e.gameboard.ships.forEach((e=>{const a=e.locationsH,r=e.locationsV,o=t.filter((e=>a.includes(parseInt(e.attributes[1].value))&&r.includes(parseInt(e.attributes[2].value))));e.newShip.isSunk()&&o.forEach((e=>e.classList.add("down")))}))}(t),n.target.removeEventListener("click",l)}(t.gameboard.allSunk()||e.gameboard.allSunk())&&o.forEach((e=>{e.removeEventListener("click",l)})),o.forEach((e=>{e.addEventListener("click",l)}))})(e,t)}l.addEventListener("dragstart",m),n.addEventListener("dragstart",m),s.addEventListener("dragstart",m),c.addEventListener("dragstart",m),r.forEach((e=>{e.addEventListener("dragleave",g)})),r.forEach((e=>{e.addEventListener("dragover",f)})),r.forEach((e=>{e.addEventListener("drop",y)}))}(r,o)})();